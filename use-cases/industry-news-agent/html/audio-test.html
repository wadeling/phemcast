<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éŸ³é¢‘æ’­æ”¾å™¨æµ‹è¯• - Industry News Agent</title>
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ§ éŸ³é¢‘æ’­æ”¾å™¨æµ‹è¯•</h1>
        
        <div class="form-group">
            <label for="test-token">æµ‹è¯•éŸ³é¢‘ Token:</label>
            <input type="text" id="test-token" placeholder="è¾“å…¥éŸ³é¢‘è®¿é—®tokenè¿›è¡Œæµ‹è¯•" value="test-token-123">
            <small class="form-hint">ğŸ’¡ è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆçš„éŸ³é¢‘è®¿é—®tokenæ¥æµ‹è¯•æ’­æ”¾åŠŸèƒ½</small>
        </div>
        
        <button onclick="testAudioPlayer()">ğŸ§ª æµ‹è¯•éŸ³é¢‘æ’­æ”¾å™¨</button>
        
        <!-- éŸ³é¢‘æ’­æ”¾åŒºåŸŸ -->
        <div id="audio-section" style="display: none;">
            <div class="audio-container">
                <h3>ğŸ§ æŠ¥å‘ŠéŸ³é¢‘</h3>
                <div id="audio-player">
                    <audio id="report-audio" controls style="width: 100%; margin: 10px 0;">
                        <source id="audio-source" src="" type="audio/mpeg">
                        æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒéŸ³é¢‘æ’­æ”¾ã€‚
                    </audio>
                    <div class="audio-info">
                        <p><strong>çŠ¶æ€:</strong> <span id="audio-status">å‡†å¤‡å°±ç»ª</span></p>
                        <p><strong>æœ‰æ•ˆæœŸ:</strong> <span id="audio-expiry">24å°æ—¶</span></p>
                        <p><strong>ç›´æ¥é“¾æ¥:</strong> <a id="audio-direct-link" href="" target="_blank" style="color: #007bff;">åœ¨æ–°çª—å£æ‰“å¼€</a></p>
                    </div>
                    <div class="audio-controls">
                        <button id="play-audio" class="audio-btn" onclick="playAudio()">â–¶ï¸ æ’­æ”¾</button>
                        <button id="pause-audio" class="audio-btn" onclick="pauseAudio()" style="display: none;">â¸ï¸ æš‚åœ</button>
                        <button id="stop-audio" class="audio-btn" onclick="stopAudio()">â¹ï¸ åœæ­¢</button>
                        <button id="download-audio" class="audio-btn" onclick="downloadAudio()">ğŸ’¾ ä¸‹è½½</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="features">
            <strong>æµ‹è¯•è¯´æ˜:</strong><br>
            â€¢ è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆçš„éŸ³é¢‘è®¿é—®token<br>
            â€¢ ç‚¹å‡»æµ‹è¯•æŒ‰é’®æŸ¥çœ‹éŸ³é¢‘æ’­æ”¾å™¨<br>
            â€¢ æµ‹è¯•å„ç§æ’­æ”¾æ§åˆ¶åŠŸèƒ½<br>
            â€¢ éªŒè¯éŸ³é¢‘é“¾æ¥å’Œä¸‹è½½åŠŸèƒ½
        </div>
    </div>
    
    <script>
        // éŸ³é¢‘æ§åˆ¶å‡½æ•°
        function playAudio() {
            const audio = document.getElementById('report-audio');
            const playBtn = document.getElementById('play-audio');
            const pauseBtn = document.getElementById('pause-audio');
            
            audio.play();
            playBtn.style.display = 'none';
            pauseBtn.style.display = 'inline-block';
            document.getElementById('audio-status').textContent = 'æ’­æ”¾ä¸­...';
        }
        
        function pauseAudio() {
            const audio = document.getElementById('report-audio');
            const playBtn = document.getElementById('play-audio');
            const pauseBtn = document.getElementById('pause-audio');
            
            audio.pause();
            playBtn.style.display = 'inline-block';
            pauseBtn.style.display = 'none';
            document.getElementById('audio-status').textContent = 'å·²æš‚åœ';
        }
        
        function stopAudio() {
            const audio = document.getElementById('report-audio');
            const playBtn = document.getElementById('play-audio');
            const pauseBtn = document.getElementById('pause-audio');
            
            audio.pause();
            audio.currentTime = 0;
            playBtn.style.display = 'inline-block';
            pauseBtn.style.display = 'none';
            document.getElementById('audio-status').textContent = 'å·²åœæ­¢';
        }
        
        function downloadAudio() {
            const audio = document.getElementById('report-audio');
            const audioUrl = audio.src;
            
            if (audioUrl) {
                const link = document.createElement('a');
                link.href = audioUrl;
                link.download = 'report_audio.mp3';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            } else {
                alert('æ²¡æœ‰å¯ä¸‹è½½çš„éŸ³é¢‘æ–‡ä»¶');
            }
        }
        
        // æ˜¾ç¤ºéŸ³é¢‘æ’­æ”¾å™¨
        function showAudioPlayer(audioData) {
            const audioSection = document.getElementById('audio-section');
            const audioSource = document.getElementById('audio-source');
            const audioDirectLink = document.getElementById('audio-direct-link');
            const audioExpiry = document.getElementById('audio-expiry');
            
            // è®¾ç½®éŸ³é¢‘æº
            const audioUrl = `/audio/${audioData.access_token}`;
            audioSource.src = audioUrl;
            
            // é‡æ–°åŠ è½½éŸ³é¢‘å…ƒç´ 
            const audio = document.getElementById('report-audio');
            audio.load();
            
            // è®¾ç½®ç›´æ¥é“¾æ¥
            audioDirectLink.href = audioUrl;
            
            // è®¾ç½®è¿‡æœŸæ—¶é—´
            if (audioData.expires_at) {
                const expiryDate = new Date(audioData.expires_at);
                const now = new Date();
                const timeLeft = expiryDate - now;
                const hoursLeft = Math.floor(timeLeft / (1000 * 60 * 60));
                const minutesLeft = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                
                if (timeLeft > 0) {
                    audioExpiry.textContent = `${hoursLeft}å°æ—¶${minutesLeft}åˆ†é’Ÿ`;
                } else {
                    audioExpiry.textContent = 'å·²è¿‡æœŸ';
                }
            }
            
            // æ˜¾ç¤ºéŸ³é¢‘åŒºåŸŸ
            audioSection.style.display = 'block';
            
            // æ»šåŠ¨åˆ°éŸ³é¢‘åŒºåŸŸ
            audioSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        // éšè—éŸ³é¢‘æ’­æ”¾å™¨
        function hideAudioPlayer() {
            document.getElementById('audio-section').style.display = 'none';
        }
        
        // æµ‹è¯•éŸ³é¢‘æ’­æ”¾å™¨
        function testAudioPlayer() {
            const token = document.getElementById('test-token').value.trim();
            
            if (!token) {
                alert('è¯·è¾“å…¥ä¸€ä¸ªæœ‰æ•ˆçš„token');
                return;
            }
            
            // æ¨¡æ‹ŸéŸ³é¢‘æ•°æ®
            const mockAudioData = {
                access_token: token,
                expires_at: new Date(Date.now() + 24 * 60 * 60 * 1000).toISOString(),
                success: true
            };
            
            // æ˜¾ç¤ºéŸ³é¢‘æ’­æ”¾å™¨
            showAudioPlayer(mockAudioData);
            
            // æ›´æ–°çŠ¶æ€
            document.getElementById('audio-status').textContent = 'æµ‹è¯•æ¨¡å¼ - å‡†å¤‡å°±ç»ª';
        }
        
        // é¡µé¢åŠ è½½å®Œæˆåçš„åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('éŸ³é¢‘æ’­æ”¾å™¨æµ‹è¯•é¡µé¢åŠ è½½å®Œæˆ');
        });
    </script>
</body>
</html>
